{% extends "base.html" %}
{% block title %}Enhanced SEO Audit Tool{% endblock %}
{% block content %}

<div class="container-xxl py-4">

  <!-- TOP-BAR & THEME-SWITCH -->
  <div class="d-flex justify-content-end">
    <button id="themeSwitch" class="btn btn-sm btn-outline-light rounded-pill">
      <span class="d-dark">ðŸŒ™ Dark</span>
      <span class="d-light">â˜€ Light</span>
    </button>
  </div>

  <!-- HERO + STATS -->
  <div class="row g-4 align-items-center mb-5">
    <div class="col-lg-6 order-lg-1 text-center text-lg-start">
      <h1 class="display-5 fw-bold mb-3">
        <span class="text-gradient">Enhanced SEO Audit Tool</span>
        <sup class="badge bg-info ms-1">v3</sup>
      </h1>
      <p class="lead">Whole-site crawler â€¢ SERP competitor snapshot â€¢ CSV export â€¢ Smart cache</p>
    </div>

    <div class="col-lg-6 order-lg-2">
      <div class="row gy-3 text-center">
        {% for _id,label in [
          ('stat-pages','Pages'),
          ('stat-issues','Issues'),
          ('stat-cache','Cache'),
          ('stat-score','Score')] %}
        <div class="col-6 col-md-3">
          <div class="neo-card">
            <div id="{{ _id }}" class="neo-stat">0</div>
            <small class="text-muted">{{ label }}</small>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>

  <!-- FORM -->
  <form id="analysis-form" class="neo-form mx-auto" style="max-width:880px" novalidate>
    <div class="row g-4">
      <div class="col-md-7">
        <label class="form-label fw-semibold" for="website_url">Website URL</label>
        <input id="website_url" name="website_url" type="url"
               class="form-control form-control-lg" required
               placeholder="https://example.com" />
        <div class="invalid-feedback">Enter a valid URL incl. https://</div>
      </div>
      <div class="col-md-5">
        <label class="form-label fw-semibold" for="target_keyword">Target keyword</label>
        <input id="target_keyword" name="target_keyword" type="text"
               class="form-control form-control-lg" required
               placeholder="digital marketing"/>
        <div class="invalid-feedback">Keyword required</div>
      </div>

      <!-- analysis-type -->
      <div class="col-12">
        <label class="form-label fw-semibold"><i class="fas fa-cog me-1"></i>Analysis type</label>
        <div class="row g-2">
          {% for n in [5,10,25,50] %}
          <div class="col-6 col-lg-3">
            <input class="btn-check" type="radio" name="analysis_type" id="opt{{n}}" value="{{n}}" {% if n==10 %}checked{% endif %}>
            <label class="btn btn-outline-secondary w-100" for="opt{{n}}">{{n}} pages</label>
          </div>
          {% endfor %}
          <div class="col-12">
            <input class="btn-check" type="radio" name="analysis_type" id="optWhole" value="whole">
            <label class="btn btn-outline-warning w-100" for="optWhole">
              <i class="fas fa-globe me-1"></i>Whole&nbsp;website
            </label>
          </div>
        </div>
      </div>

      <!-- ADVANCED -->
      <div class="col-12">
        <button class="btn btn-sm btn-outline-info" type="button"
                data-bs-toggle="collapse" data-bs-target="#advBox">
          Advanced options
        </button>
        <div id="advBox" class="collapse mt-3">
          <div class="row row-cols-1 row-cols-md-2 g-3">
            <div class="form-check form-switch ms-3">
              <input class="form-check-input" type="checkbox" id="serp_analysis" name="serp_analysis" checked>
              <label class="form-check-label" for="serp_analysis">SERP competitor analysis</label>
            </div>
            <div class="form-check form-switch ms-3">
              <input class="form-check-input" type="checkbox" id="use_cache" name="use_cache" checked>
              <label class="form-check-label" for="use_cache">Use smart cache</label>
            </div>
          </div>
        </div>
      </div>

      <!-- SUBMIT -->
      <div class="col-12 d-grid">
        <button id="start-analysis" class="btn btn-primary btn-lg" type="submit">
          <i class="fas fa-search me-1"></i><span class="btn-text">Start audit</span>
          <span class="spinner-border spinner-border-sm d-none"></span>
        </button>
      </div>
    </div>
  </form>

  <!-- PROGRESS -->
  <div id="progressBox" class="neo-progress mt-5 d-none">
    <div class="d-flex justify-content-between">
      <span id="progLabel"><i class="fas fa-spinner fa-spin me-1"></i>Startingâ€¦</span>
      <span id="progTimer" class="text-muted"></span>
    </div>
    <div class="progress mt-2" style="height:1.25rem">
      <div id="progBar" class="progress-bar progress-bar-striped progress-bar-animated" style="width:0%">0%</div>
    </div>
  </div>

  <!-- RESULTS -->
  <div id="resultBox" class="neo-result mt-5 d-none">
    <div class="d-flex justify-content-between align-items-center mb-2">
      <h4 class="mb-0"><i class="fas fa-flag-checkered me-1"></i>Audit complete</h4>
      <div>
        <button id="toggleReport" class="btn btn-sm btn-outline-secondary">Show report</button>
        <button id="dlCsv" class="btn btn-sm btn-outline-success d-none">
          <i class="fas fa-file-csv me-1"></i>CSV
        </button>
      </div>
    </div>
    <article id="reportContent" class="neo-report collapse"></article>
  </div>

</div>

{% endblock %}

{% block scripts %}
<script>
// theme switch
const sw=document.getElementById('themeSwitch');
sw.onclick=()=>{document.documentElement.classList.toggle('theme-light');};

// report collapse
document.getElementById('toggleReport').onclick=e=>{
  const r=document.getElementById('reportContent');
  r.classList.toggle('show');
  e.target.textContent=r.classList.contains('show')?'Hide report':'Show report';
};
</script>
{% endblock %}
